<!DOCTYPE html>
<html>
    <head>
        <title>bim chat app</title>
        <meta charset="UTF-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>

        <script src="/socket.io/socket.io.js"></script>

        <link rel="stylesheet" href="styles/styles.css"></style>
    </head>
    <body>
      <button onclick="socket.emit('message', '1');">Send OSC message</button>

      <div class="messagesContainer">
        <h1>messages</h1>
      </div>



      <form onsubmit="submitMessage();return false;">
        <div class="textarea-container">
          <textarea autofocus class="inputMessage" placeholder="type something"></textarea>
          <div class="textarea-size"></div>
        </div>
        <button type="submit" class='sendButton' disabled></button>
      </form>



      <script>

        // inits
        var messages = document.querySelector('.messagesContainer'),
            inputMessage = document.querySelector('.inputMessage'),
            sendButton = document.querySelector('.sendButton');



        // socket io
        var socket = io.connect(window.location.origin);
        // var socket = io.connect('/');

        socket.on('connect', function() {
            //  console.log('connected to server socket');

            // initialize chats
            console.log(socket.id); // custom color messages
         });

        socket.on('response', function (data) {
          console.log(data);
        });

        socket.on('post', function (data) {
          post(data);
        });



        // submit message on enter key
        inputMessage.addEventListener('keypress', function(e) {
          if (e.keyCode == 13 && !e.shiftKey) {
            e.preventDefault();
            submitMessage();
            return false;
          }
        });



        // changes the send button color/state
        function checkSendState() {
          if (inputMessage.value == '') {
            sendButton.disabled = true;
          }
          else sendButton.disabled = false;
        }
        // listener for send button color/state
        inputMessage.addEventListener('input', function(e) {
          checkSendState();
        });



        // submit the form message
        function submitMessage() {
          // quick validation
          if ( inputMessage.value != '' ) {
            socket.emit('message', inputMessage.value);
          }
        }



        // post message to container 
        function post(data) {
          let message = document.createElement('div');
          message.className = 'message';
          message.innerHTML = data;
          messages.appendChild(message);
          inputMessage.value = '';

          // resets
          autoSize();
          checkSendState();
          input.focus();
        }



        // text container magic
        var textContainer, textareaSize, input;
        var autoSize = function () {
          textareaSize.innerHTML = input.value + '\n';
        };
        document.addEventListener('DOMContentLoaded', function() {
          textContainer = document.querySelector('.textarea-container');
          textareaSize = textContainer.querySelector('.textarea-size');
          input = textContainer.querySelector('textarea');

          autoSize();
          input.addEventListener('input', autoSize);
          input.focus();
        });



        // document.documentElement.style.setProperty(`--user-color`, 'red');

      </script>
    </body>
</html>
